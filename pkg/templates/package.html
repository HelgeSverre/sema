{% extends "base.html" %}
{% block title %}{{ name }} — Sema Pkg{% endblock %}
{% block head %}
<style>
  .detail-grid {
    display: grid;
    grid-template-columns: 1fr 240px;
    gap: 2.5rem;
    align-items: start;
  }

  .detail-sidebar section {
    margin-bottom: 1.5rem;
  }

  .detail-sidebar .section-label {
    margin-bottom: 0.4rem;
  }

  .sidebar-value {
    font-size: 0.78rem;
    color: var(--text);
    line-height: 1.6;
  }

  .sidebar-link {
    font-size: 0.78rem;
    color: var(--gold);
    display: block;
    line-height: 1.6;
  }

  .readme {
    font-size: 0.82rem;
    line-height: 1.75;
    color: var(--text);
  }

  .readme h2 {
    font-size: 1rem;
    color: var(--text-bright);
    margin: 2rem 0 0.5rem;
    padding-bottom: 0.3rem;
    border-bottom: 1px solid var(--border);
  }

  .readme h2:first-child { margin-top: 0; }

  .readme p { margin-bottom: 0.75rem; }

  .readme pre {
    background: var(--bg-code);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1rem;
    overflow-x: auto;
    margin-bottom: 0.75rem;
    font-size: 0.78rem;
    line-height: 1.6;
  }

  .readme code {
    font-family: var(--mono);
    font-size: 0.82em;
    color: var(--gold);
  }

  .readme pre code {
    color: var(--text-bright);
    font-size: inherit;
  }

  .dep-list {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .dep-list a {
    font-size: 0.75rem;
    color: var(--gold);
  }

  .dep-list span {
    font-size: 0.65rem;
    color: var(--text-dim);
    margin-left: 0.25rem;
  }

  /* ── Tab panels ── */
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  .dep-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.78rem;
  }

  .dep-table th {
    text-align: left;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-dim);
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border);
    font-weight: normal;
  }

  .dep-table td {
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
    color: var(--text);
  }

  .dep-table td:first-child a {
    color: var(--gold);
    font-size: 0.8rem;
  }

  .dep-table td:nth-child(2) {
    font-size: 0.75rem;
    color: var(--text-dim);
  }

  .dep-table td:nth-child(3) {
    font-size: 0.72rem;
    color: var(--text-dim);
  }

  .dep-direction {
    margin-bottom: 2rem;
  }

  .dep-direction h3 {
    font-size: 0.78rem;
    color: var(--text-bright);
    margin-bottom: 0.5rem;
  }

  @media (max-width: 768px) {
    .detail-grid {
      grid-template-columns: 1fr;
    }
    .detail-sidebar {
      order: -1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
  }
</style>
{% endblock %}
{% block header_center %}
<form action="/search" method="get" class="search-bar" style="max-width:22rem;">
  <input type="text" name="q" class="search-input" placeholder="Search packages…">
  <button type="submit" class="search-btn">Search</button>
</form>
{% endblock %}
{% block content %}
<div class="page-content">
  <div style="margin-bottom:1.5rem;">
    <div style="display:flex; align-items:baseline; gap:0.6rem; flex-wrap:wrap;">
      <h1 style="font-size:1.3rem; color:var(--gold); font-weight:500;">{{ name }}</h1>
      {% if let Some(v) = versions.first() %}
      <span class="badge badge-gold">{{ v.version }}</span>
      {% endif %}
    </div>
    <p style="font-size:0.82rem; color:var(--text); margin-top:0.35rem;">{{ description }}</p>
    <div style="margin-top:0.75rem;">
      <div class="install-snippet" style="display:inline-flex;">
        <span class="prompt">$</span> sema pkg install {{ name }}
      </div>
    </div>
  </div>

  <div class="tabs">
    <a href="#versions" class="tab active" data-tab="versions">Versions <span style="font-size:0.6rem; color:var(--text-dim);">{{ versions.len() }}</span></a>
    <a href="#deps" class="tab" data-tab="deps">Dependencies <span style="font-size:0.6rem; color:var(--text-dim);">{{ deps.len() }}</span></a>
  </div>

  <div class="detail-grid">
    <div>
      <div class="tab-panel active" id="versions">
        <table class="dep-table">
          <thead><tr><th>Version</th><th>Size</th><th>Published</th></tr></thead>
          <tbody>
            {% for v in versions %}
            <tr>
              <td><a href="/packages/{{ name }}">{{ v.version }}{% if v.yanked %} <span class="tag" style="color:var(--error);">yanked</span>{% endif %}</a></td>
              <td style="font-size:0.72rem; color:var(--text-dim);">{{ v.size_bytes / 1024 }} KB</td>
              <td style="font-size:0.72rem; color:var(--text-dim);">{{ v.published_at }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="tab-panel" id="deps">
        {% if deps.is_empty() %}
        <div class="empty-state">No dependencies</div>
        {% else %}
        <table class="dep-table">
          <thead><tr><th>Package</th><th>Version</th></tr></thead>
          <tbody>
            {% for dep in deps %}
            <tr>
              <td><a href="/packages/{{ dep.dependency_name }}">{{ dep.dependency_name }}</a></td>
              <td style="font-size:0.75rem; color:var(--text-dim);">{{ dep.version_req }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </div>
    </div>

    <aside class="detail-sidebar">
      <section>
        <div class="section-label">Owners</div>
        {% for owner in owners %}
        <div class="sidebar-value">{{ owner }}</div>
        {% endfor %}
      </section>

      {% if let Some(url) = repository_url %}
      <section>
        <div class="section-label">Repository</div>
        <a href="{{ url }}" class="sidebar-link">{{ url }}</a>
      </section>
      {% endif %}

      {% if let Some(v) = versions.first() %}
      {% if let Some(req) = v.sema_version_req %}
      <section>
        <div class="section-label">Sema Version</div>
        <div class="sidebar-value">{{ req }}</div>
      </section>
      {% endif %}
      {% endif %}

      {% if !deps.is_empty() %}
      <section>
        <div class="section-label">Dependencies</div>
        <div class="dep-list">
          {% for dep in deps %}
          <div><a href="/packages/{{ dep.dependency_name }}">{{ dep.dependency_name }}</a><span>{{ dep.version_req }}</span></div>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      <section>
        <div class="section-label">Versions</div>
        <table class="data-table" style="font-size:0.72rem;">
          {% for v in versions %}
          <tr>
            <td{% if loop.first %} style="color:var(--gold);"{% endif %}>{{ v.version }}</td>
            <td style="color:var(--text-dim);">{{ v.published_at }}</td>
          </tr>
          {% endfor %}
        </table>
      </section>
    </aside>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  document.querySelectorAll('.tab[data-tab]').forEach(tab => {
    tab.addEventListener('click', e => {
      e.preventDefault();
      document.querySelectorAll('.tab[data-tab]').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });
</script>
{% endblock %}
